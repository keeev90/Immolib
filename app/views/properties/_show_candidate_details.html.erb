<div class="candidate-profile-details-wrapper">
  <div class="candidate-profile-details-section">
    <% if appointment.candidate.profile_picture.attached?%>
      <div class="profile-wrapper__informations__right mb1">
        <%= image_tag appointment.candidate.profile_picture, alt: 'profile picture' %>
      </div>
    <% else %>
      <div class="profile-wrapper__informations__right nopic mb1">
        <p> Aucune photo de profil </p>
      </div>
    <% end %>
    <% if appointment.candidate.first_name && appointment.candidate.last_name %>
      <h3> <%= appointment.candidate.first_name %> <%= appointment.candidate.last_name %> </h3>
    <% end %>
  </div>

  <div class="candidate-profile-details-section">
    <p class="bolder"><i class="fas fa-at"></i> Email</p>
    <p><%= appointment.candidate.email %></p>
  </div>

  <div class="candidate-profile-details-section">
    <p class="bolder"><i class="far fa-calendar-check"></i></i> Visite</p>
      <%if appointment.slot.start_date > DateTime.now%>
      <p>Prochaine visite pr√©vue le <%= appointment.slot.start_date.strftime("%d/%m") %> √† <%= appointment.slot.start_date.strftime("%H:%M") %></p>
    <%elsif appointment.slot.start_date < DateTime.now%>
      <p>Derni√®re visite r√©alis√©e le <%= appointment.slot.start_date.strftime("%d/%m") %> √† <%= appointment.slot.start_date.strftime("%H:%M") %></p>
    <%else%>
      <p>Aucune visite programm√©e</p>
    <%end%>
  </div>

  <div class="candidate-profile-details-section">
    <p class="bolder"><i class="far fa-comment"></i> Message </p>
    <% if appointment.candidate_message %>
      <p><em><%= simple_format(appointment.candidate_message) %></em></p>
    <% else %>
      <p><small><em> Ce candidat ne vous a pas encore adress√© de message</em></small></p>
    <% end %>
  </div>

  <% if appointment.slot.property.owner_project == "rent" %>
    <div class="candidate-profile-details-section">

      <% if appointment.candidate_dossierfacile_folder.attached? %>
        <p class="bolder"><i class="far fa-folder-open"></i> Dossier de location (r√©alis√© via <%= link_to "DossierFacile", "https://www.dossierfacile.fr/", class:"primary", target: '_blank' %>)</p>
        <p class="mb1"><small><em>DossierFacile est une plateforme publique gratuite d'aide √† la cr√©ation de dossier de location. Elle joue le r√¥le de tiers de confiance entre locataires et propri√©taires.</em></small></p>
        <div class="candidate-document mb1">
          <p>
            <%= appointment.candidate_dossierfacile_folder.filename %> 
            <%# if doc.previewable? %>
              <%= link_to raw("<i class='far fa-eye'></i>"), rails_blob_path(appointment.candidate_dossierfacile_folder, disposition: 'preview'), target: '_blank' %>
            <%# end %> 
            <%= link_to raw("<i class='fas fa-download'></i>"), rails_blob_path(appointment.candidate_dossierfacile_folder, disposition: 'attachment') %>
          </p>
          <% if appointment.candidate_dossierfacile_link && appointment.candidate_dossierfacile_link != "" %>
            <p class="mt1">Lien de son dossier : <%= link_to appointment.candidate_dossierfacile_link, appointment.candidate_dossierfacile_link, target: '_blank' %></p>
          <% end %>
        </div>
        <p><small> ‚úîÔ∏è Dossier complet</small></p>

      <% elsif appointment.candidate_dossierfacile_link && appointment.candidate_dossierfacile_link != "" %>
        <p class="bolder"><i class="far fa-folder-open"></i> Dossier de location (r√©alis√© via <%= link_to "DossierFacile", "https://www.dossierfacile.fr/", class:"primary", target: '_blank' %>)</p>
        <p class="mb1"><small><em>DossierFacile est une plateforme publique gratuite d'aide √† la cr√©ation de dossier de location. Elle joue le r√¥le de tiers de confiance entre locataires et propri√©taires.</em></small></p>
        <p class="mb1">Lien de son dossier : <%= link_to appointment.candidate_dossierfacile_link, appointment.candidate_dossierfacile_link, target: '_blank' %></p>
        <p><small> ‚úîÔ∏è Dossier complet</small></p>

      <% elsif appointment.candidate_documents.attached? %>
        <p class="bolder"><i class="far fa-folder-open"></i> Dossier de location</p>
        <% appointment.candidate_documents.each do |doc| %>
          <div class="candidate-document">
            <p>
              <%= doc.filename %> 
              <%# if doc.previewable? %>
                <%= link_to raw("<i class='far fa-eye'></i>"), rails_blob_path(doc, disposition: 'preview'), target: '_blank' %>
              <%# end %> 
              <%= link_to raw("<i class='fas fa-download'></i>"), rails_blob_path(doc, disposition: 'attachment') %>
            </p>
          </div>
        <% end %>
        
        <p><progress id="file" max="5" value="<%=appointment.candidate_documents.size%>" class="<%=appointment.candidate_documents.size > 4 ? 'full' : nil %>"> </progress></p>
        <% if appointment.candidate_documents.size < 5 %>
          <p><small>Documents transmis : <%= appointment.candidate_documents.size %> / 5</small></p>
        <% else %>
          <p><small> ‚úîÔ∏è Dossier complet</small></p>
        <% end %>
      
      <% else %>
        <p class="bolder"><i class="far fa-folder-open"></i> Dossier de location</p>
        <p><small><em>Ce candidat n'a pas encore transmis de documents</em></small></p>
      <% end %>
    </div>
  <% end %>

  <div class="form-page">
    <div class="form-page__form">
      <%if appointment.is_interested == true %>
        <%if appointment.is_accepted == true %>
          <%if appointment.property.owner_project == "rent"%>
            <div class="text-center">
              <p>‚úîÔ∏è <span class="bolder green">Vous avez valid√© cette candidature !</span></p>
              <p class="mb1"><small><em>Votre r√©ponse a √©t√© transmise au candidat</em></small></p>
              <p class="mb1">‚ö†Ô∏è Pour la <span class="bolder">signature du bail de location</span>, prenez contact avec le candidat directement par email</p>
              <p class="mb1 bg-success"> <%= appointment.candidate.email%></p>
              <p><small><em><i class="fas fa-info-circle"></i> Les visistes √† venir ont √©t√© automatiquement annul√©es et les candidats concern√©s on √©t√© pr√©venus</em></small></p>
            </div>
          <%else%>
            <div class="text-center">
              <p>‚úîÔ∏è <span class="bolder green">Vous avez valid√© cette offre !</span></p>
              <p class="mb1"><small><em>Votre r√©ponse a √©t√© transmise au candidat</em></small></p>
              <p class="mb1">‚ö†Ô∏è Pour la <span class="bolder">signature du compromis de vente</span>, prenez contact avec le candidat directement par email</p>
              <p class="mb1 bg-success"> <%= appointment.candidate.email%></p>
              <p><small><em><i class="fas fa-info-circle"></i> Les visistes √† venir ont √©t√© automatiquement annul√©es et les candidats concern√©s on √©t√© pr√©venus</em></small></p>
            </div>
          <%end%>
        <%elsif appointment.is_accepted == false %>
          <%if appointment.property.owner_project == "rent"%>
            <div class="text-center">
              <p>‚ùå <span class="bolder danger">Vous n'avez pas souhait√© valider cette candidature</span></p>
              <p class="mb1"><small><em>Votre r√©ponse a √©t√© transmise au candidat</em></small></p>
            </div>
          <%else%>
            <div class="text-center">
              <p>‚ùå <span class="bolder danger">Vous n'avez pas souhait√© valider cette offre d'achat</span></p>
              <p class="mb1"><small><em>Votre r√©ponse a √©t√© transmise au candidat</em></small></p>
            </div>
          <%end%>
        <%else%>
          <%if appointment.property.owner_project == "rent"%>
            <div class="text-center">
              <p> üëç <span class="bolder">Le candidat a confirm√© son int√©r√™t pour votre logement</span></p>
              <p class="mt2">Souhaitez-vous valider cette candidature ?</p>
              <p class="mb1"><small><em>Votre r√©ponse sera automatiquement transmise au candidat</em></small></p>
              <p class="mb1"><small>üí° Appuyez-vous sur le dossier de location et le message du candidat</small></p>
              <p><small>‚ö†Ô∏è Si votre r√©ponse est positive, vous pourrez prendre contact avec le candidat directement par email pour la signature du bail. Les visistes √† venir seront automatiquement annul√©es et les candidats concern√©s seront pr√©venus.</small></p>
            </div>
          <%else%>
            <div class="text-center">
              <p>üëç <span class="bolder">Le candidat a fait une offre d'achat pour votre logement</span></p>
              <p class="mt2">Souhaitez-vous valider cette offre d'achat ?</p>
              <p class="mb1"><small><em>Votre r√©ponse sera automatiquement transmise au candidat</em></small></p>
              <p class="mb1"><small>üí° Appuyez-vous sur le message du candidat qui accompagne sa proposition</small></p>
              <p><small>‚ö†Ô∏è Si votre r√©ponse est positive, vous pourrez prendre contact avec le candidat directement par email pour la signature du compromis de vente. Les visites √† venir seront automatiquement annul√©es et les candidats concern√©s seront pr√©venus.</small></p>
            </div>
          <%end%>
          <%= form_with model: appointment, url: appointment_owner_decision_path(appointment), method: "patch", local: true, class: "form", id: "item-form", multipart: true do |f| %>
            <div class="radio-button">
              <%= f.label "Oui" %>
              <%= f.radio_button :is_accepted, true %>
            </div>
            <br/>
            <div class="radio-button">
              <%= f.label "Non" %>
              <%= f.radio_button :is_accepted, false %>
            </div>
            <div>
              <%= f.submit "Valider", class: "btn white-btn bg-primary" %>
            </div>
          <%end%>
        <%end%>
      <%elsif appointment.is_interested == false %>
        <p class="text-center">‚ö†Ô∏è <span class="bolder">Le candidat a indiqu√© ne pas √™tre int√©ress√© par votre logement</span></p>
        <%= link_to "Supprimer la candidature", appointment_path(id: appointment, owner: true), method: "delete", data: {confirm: "√ätes-vous s√ªr ? Cette action est irr√©versible."}, class:"btn small-btn white-btn bg-warning text-center" %>
      <%else%>
        <div class="candidate-profile-details-section text-center">
          <p> Cette candidature ne vous convient pas ? </p>
          <%= link_to "Refuser la candidature", appointment_path(id: appointment, owner: true), method: "delete", data: {confirm: "√ätes-vous s√ªr ? Cette action est irr√©versible."}, class:"btn small-btn white-btn bg-warning" %>
          <p><small><em><i class="fas fa-info-circle"></i> En cas de refus, le candidat sera automatiquement pr√©venu par email</em></small></p>
        </div>
      <%end%>
    </div>
  </div>
</div>

